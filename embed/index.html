<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark">
	<title>https://le-herisson.github.io/embed</title>
</head>
<body>
  <noscript>
    <p>
      This site is best viewed with Javascript please use 'chrome://settings/content/siteDetails?site=https%3A%2F%2Fle-herisson.github.io'
    </p>
  </noscript>
  <script type="text/javascript">
    var currentEnabled = null;
    function enableElement(elem) {
      if (currentEnabled) {
        currentEnabled.disabled = true;
      }
      elem.disabled = false;
      currentEnabled = elem;
    }

    function get_video_id(input, type) {
      switch (type) {
        case "short":
          return input.match(/https\:\/\/youtu\.be\/([a-zA-Z0-9-_]{11})/)[1];
        
        case "long":
          return input.match(/(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/shorts\/))([a-zA-Z0-9-_]{11})/)[1];

        case "id":
          return input.match(/([a-zA-Z0-9-_]{11})/g)[0];
      
        default:
          throw new Error("Error Invalid youtube link !");
      }       
    }

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('Go_button').addEventListener('click', async function () {
        sLinkIo = document.getElementById("sLinkI");
        bLinkIo = document.getElementById("bLinkI");
        vIdIo = document.getElementById("vIdI");

        if (sLinkIo.disabled && bLinkIo.disabled && vIdIo.disabled) {
          alert("Error :\nPlease check an option\nand fill all the requireds fields!")
        } else {
          if (!sLinkIo.disabled) { console.debug(`calulated id : ${get_video_id(sLinkIo.value, "short")}`); sLinkIo.value = get_video_id(sLinkIo.value, "short"); }
          if (!bLinkIo.disabled) { console.debug(`calulated id : ${get_video_id(bLinkIo.value, "long")}`); bLinkIo.value = get_video_id(bLinkIo.value, "long"); }
          if (!vIdIo.disabled) { console.debug(`calulated id : ${get_video_id(vIdIo.value, "id")}`); vIdIo.value = get_video_id(vIdIo.value, "id"); }

          document.getElementById("VidForm").action = await getLink();
          document.getElementById("VidForm").submit();
        }
      });
      document.getElementById('Rst_button').addEventListener('click', function () {
        if(confirm('Reset form ?')) {
          document.getElementById("VidForm").reset();
        }
      });
  	  document.getElementById('sLinkRb').addEventListener('change', function () {
	  	  if (this.checked) {
          document.getElementById('sLinkI').focus();
        }
  	  });
      document.getElementById('bLinkRb').addEventListener('change', function () {
	  	  if (this.checked) {
          document.getElementById('bLinkI').focus();
        }
  	  });
      document.getElementById('vIdRb').addEventListener('change', function () {
	  	  if (this.checked) {
          document.getElementById('vIdI').focus();
        }
  	  });
    });

    async function getLink() {
      await fetch("../Api/conf.json")
              .then(function(response) { return response.json(); })
              .then(function(resJson) { res = resJson; });
      env = res[2].env;
      console.debug(env);
      return(env == "production" ? "./youtube/index.html" : "./youtube");
    }
  </script>
  <style>
    div.topbar {
      display: flex;
      justify-content: space-between;
    }
    a.link_homepage {
      justify-content: flex-start;
    }
    a.link_back {
      justify-content: flex-end;
    }
    .wip {
      cursor: help;
    }
    .vRb, .button, .link, label {
      cursor: pointer;
    }
  </style>
  <div class="topbar">
    <a title="../" class="link link_homepage" id="linkHomepage" href="../">Home</a>
	  <a title="Go back in browser history" class="link link_back" id="back" href="javascript:history.back();">Back</a>
  </div>
  <hr></hr>
  <h2>YouTube videos without ads :</h2>
  <form id="VidForm" method="get">
    <dl>
      <dt>Video</dt>
      <fieldset>
        <dd>
          <input class="vRb" type="radio" id="sLinkRb" name="VideoRb" value="sLink" onclick="enableElement(this.form.elements['sLinkI']);" />
          <label for="sLinkRb">Link (small) : </label>
          <input disabled type="url" id="sLinkI" name="vId" minlength="28" maxlength="39" size="28" />
        </dd>
        <dd>
          <input class="vRb" type="radio" id="bLinkRb" name="VideoRb" value="bLink" onclick="enableElement(this.form.elements['bLinkI']);" />
          <label for="bLinkRb">Link (big) : </label>
          <input disabled type="url" id="bLinkI" name="vId" minlength="39" size="39" />
        </dd>
        <dd>
          <input class="vRb" type="radio" id="vIdRb" name="VideoRb" value="vId" onclick="enableElement(this.form.elements['vIdI']);" />
          <label for="vIdRb">Id : </label>
          <input disabled type="text" id="vIdI" name="vId" minlength="11" maxlength="11" size="11" />
        </dd>
      </fieldset>
      <dt>Options</dt>
      <fieldset>
        <dd>
          <strong title="Work In Progress" class="wip" style="color:red;">[WIP]</strong>
          <label for="VideoPlayers">Video player : </label>
          <select disabled title="Required" class="vp required"  id="VideoPlayers" name="VP" required>
            <option disabled="disabled">Please select an option</option>
            <option id="VP_OYTP" value="OYTP" name="VP_OYTP">Official YouTube Player</option>
            <option id="VP_YTNC" value="YTNC" name="VP_YTNC">YT nocookies</option>
            <option id="VP_EP" value="EP" name="VP_EP">Embed player</option>
          </select>
        </dd>
        <dd>
          <label for="option_dm_cb">darkmode :</label>
          <input id="option_dm_cb" type="checkbox" name="dm" checked>
        </dd>
      </fieldset>
    </dl>
    <button title="Generate link" class="button go" id="Go_button" type="button">Go</button>
    <button title="Reset all the fields" class="button rst" id="Rst_button" type="button">Reset</button>
  </form>
</body>
</html>
